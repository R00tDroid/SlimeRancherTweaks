cmake_minimum_required(VERSION 3.15)

project(SRDrones VERSION 0.1.0 LANGUAGES CSharp)

include(CSharpUtilities)

execute_process(COMMAND CMD /c powershell ${CMAKE_CURRENT_LIST_DIR}/FindUnity.ps1 OUTPUT_STRIP_TRAILING_WHITESPACE OUTPUT_VARIABLE UnityLocation)
set(UnityLibraries "${UnityLocation}\\Editor\\Data\\Managed")
message("Unity library location: ${UnityLibraries}")

file(GLOB_RECURSE SRMLSources
    ${CMAKE_CURRENT_LIST_DIR}/SRML/SRML/*.*
)

file(GLOB_RECURSE SourceFiles
    ${CMAKE_CURRENT_LIST_DIR}/Source/*.*
)

add_executable(SRDrones ${SourceFiles} ${SRMLSources})

LIST(APPEND VS_DOTNET_REFERENCES "System")
LIST(APPEND VS_DOTNET_REFERENCES "${CMAKE_CURRENT_LIST_DIR}\\Libs\\Assembly-CSharp.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${UnityLibraries}\\UnityEngine.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${UnityLibraries}\\UnityEditor.dll")

set_target_properties(SRDrones PROPERTIES
    VS_DOTNET_REFERENCES "${VS_DOTNET_REFERENCES}"
)

LIST(APPEND VS_PACKAGE_REFERENCES "Lib.Harmony_2.1.1")

set_target_properties(SRDrones PROPERTIES
    VS_PACKAGE_REFERENCES "${VS_PACKAGE_REFERENCES}"
)

target_compile_options(SRDrones PUBLIC "/unsafe")
