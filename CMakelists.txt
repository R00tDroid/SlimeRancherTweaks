cmake_minimum_required(VERSION 3.15)

project(SRDrones VERSION 0.1.0 LANGUAGES CSharp)

include(CSharpUtilities)

file (STRINGS "${CMAKE_CURRENT_LIST_DIR}\\Libs\\GameLocation.txt" GameLocation)
message("Game location: ${GameLocation}")

LIST(APPEND VS_DOTNET_REFERENCES "System")

LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SRML\\Libs\\0Harmony.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SRML\\Libs\\INIFileParser.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SRML\\Libs\\Newtonsoft.Json.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${CMAKE_CURRENT_LIST_DIR}\\Libs\\Assembly-CSharp.dll")

LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.CoreModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.IMGUIModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.UIModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.AnimationModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.AssetBundleModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.AudioModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.PhysicsModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.InputLegacyModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.ParticleSystemModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.ParticleSystemModule.dll")

LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\Unity.TextMeshPro.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\UnityEngine.UI.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\InControl.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\SlimeRancher_Data\\Managed\\SRML.dll")

file(GLOB_RECURSE SourceFiles
    ${CMAKE_CURRENT_LIST_DIR}/Source/*.cs
)

set(ResourceFiles
    ${CMAKE_CURRENT_LIST_DIR}/Source/modinfo.json
)

add_library(SRDrones SHARED ${SourceFiles} ${ResourceFiles})

set_property(SOURCE ${ResourceFiles} PROPERTY VS_TOOL_OVERRIDE "EmbeddedResource")

set_target_properties(SRDrones PROPERTIES
    VS_DOTNET_REFERENCES "${VS_DOTNET_REFERENCES}"
)

set_target_properties(SRDrones PROPERTIES
    DOTNET_TARGET_FRAMEWORK_VERSION "v4.6.1"
)

target_compile_options(SRDrones PUBLIC "/unsafe")

add_custom_command(TARGET SRDrones POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_FILE:SRDrones> "${GameLocation}\\SRML\\Mods\\SRDrones.dll"
)
