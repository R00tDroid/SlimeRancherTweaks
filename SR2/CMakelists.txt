cmake_minimum_required(VERSION 3.15)

project(SRTweaks2 VERSION ${ProjectVersion} LANGUAGES CSharp)

include(CSharpUtilities)

file (STRINGS "${CMAKE_CURRENT_LIST_DIR}\\..\\Libs2\\GameLocation.txt" GameLocation)
message("Game location: ${GameLocation}")

LIST(APPEND VS_DOTNET_REFERENCES "System")

LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\core\\0Harmony.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\core\\BepInEx.Core.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\core\\BepInEx.Unity.IL2CPP.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\interop\\Assembly-CSharp.dll")

LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\unity-libs\\UnityEngine.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\unity-libs\\UnityEngine.CoreModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\unity-libs\\UnityEngine.IMGUIModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\unity-libs\\UnityEngine.UIModule.dll")
LIST(APPEND VS_DOTNET_REFERENCES "${GameLocation}\\BepInEx\\unity-libs\\UnityEngine.UI.dll")

file(GLOB_RECURSE SourceFiles
    ${CMAKE_CURRENT_LIST_DIR}/Source/*.cs
    ${CMAKE_CURRENT_LIST_DIR}/../Shared/*.cs
)

add_library(SRTweaks2 SHARED ${SourceFiles})

set_target_properties(SRTweaks2 PROPERTIES
    VS_DOTNET_REFERENCES "${VS_DOTNET_REFERENCES}"
)

set_target_properties(SRTweaks2 PROPERTIES
    DOTNET_TARGET_FRAMEWORK_VERSION "v4.6.1"
)

target_compile_options(SRTweaks2 PUBLIC "/unsafe")

add_custom_command(TARGET SRTweaks2 POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_FILE:SRTweaks2> "${GameLocation}\\BepInEx\\plugins\\SRTweaks.dll"
)

add_custom_target(SlimeRancher2)
add_dependencies(SlimeRancher2 SRTweaks2)
set_property(TARGET SlimeRancher2 PROPERTY
    VS_DEBUGGER_COMMAND "${GameLocation}\\SlimeRancher2.exe"
)
set_property(TARGET SlimeRancher2 PROPERTY
    VS_DEBUGGER_WORKING_DIRECTORY "${GameLocation}"
)
set_property(DIRECTORY ${CMAKE_CURRENT_LIST_DIR} PROPERTY VS_STARTUP_PROJECT SlimeRancher2)
